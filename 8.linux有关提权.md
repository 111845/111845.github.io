# 1.Linux访问权限控制基本原理

## 安全模型介绍

​		在 `Linux` 系统中，我们所有的操作实质都是在进行进程访问文件的操作。我们访问文件需要先取得相应的访问权限，而访问权限是通过 `Linux` 系统中的安全模型获得的。

在 `Linux` 系统中，我们所有的操作实质都是在进行进程访问文件的操作。我们访问文件需要先取得相应的访问权限，而访问权限是通过 `Linux` 系统中的安全模型获得的。

对于 `Linux` 系统中的安全模型，我们需要知道下面两点

1. `Linux` 系统上最初的安全模型叫 `DAC`, 全称是 `Discretionary Access Control` ，翻译为自主访问控制。
2. 后来又增加设计了一个新的安全模型叫 `MAC`, 全称是 `Mandatory Access Control`, 翻译为强制访问控制。

注意, `MAC` 和 `DAC` 不是互斥的， `DAC` 是最基本的安全模型，也是通常我们最常用到的访问控制机制是 `Linux` 必须具有的功能， 而 `MAC` 是构建在 `DAC` 之上的加强安全机制，属于可选模块。访问前， Linux系统通常都是先做 `DAC` 检查， 如果没有通过则操作直接失败; 如果通过 `DAC` 检查并且系统支持 `MAC` 模块，再做 `MAC` 权限检查。

为区分两者，我们将支持 `MAC` 的 `Linux` 系统称作 `SELinux`, 表示它是针对 `Linux` 的安全加强系统。

这里，我们将讲述 `Linux` 系统中的 `DAC` 安全模型。

## `DAC` 安全模型

`DAC` 的核心内容是：在 `Linux` 中，进程理论上所拥有的权限与执行它的用户的权限相同。其中涉及的一切内容，都是围绕这个核心进行的。

### 用户和组ID信息控制

#### 用户、组、口令信息

通过 `/etc/passwd` 和 `/etc/group` 保存用户和组信息，通过 `/etc/shadow` 保存密码口令及其变动信息， 每行一条记录。

用户和组分别用 `UID` 和 `GID` 表示，一个用户可以同时属于多个组，默认每个用户必属于一个与之 `UID` 同值同名的 `GID` 。

对于 `/etc/passwd` , 每条记录字段分别为 `用户名:口令（在 /etc/shadow 加密保存）：UID:GID（默认UID）:描述注释:主目录:登录shell(第一个运行的程序)`

对于 `/etc/group` ， 每条记录字段分别为 `组名：口令（一般不存在组口令）：GID：组成员用户列表（逗号分割的用户UID列表）`

对于 `/etc/shadow` ，每条记录字段分别为： `登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:`

举例

```
$ cat /etc/passwd |head -n 5  //显示前5个

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync

//注册名：口令：用户标识号：组标识号：用户名：用户主目录：命令解释程序
/*
(1)注册名(login_name)：用于区分不同的用户。在同一系统中注册名是惟一的。在很多系统上，该字段被限制在8个字符(字母或数字)的长度之内；并且要注意，通常在Linux系统中对字母大小写是敏感的。这与MSDOS/Windows是不一样的。
(2)口令(passwd)：系统用口令来验证用户的合法性。超级用户root或某些高级用户可以使用系统命令passwd来更改系统中所有用户的口令，普通用户也可以在登录系统后使用passwd命令来更改自己的口令。
现在的Unix/Linux系统中，口令不再直接保存在passwd文件中，通常将passwd文件中的口令字段使用一个“x”来代替，将/etc /shadow作为真正的口令文件，用于保存包括个人口令在内的数据。当然shadow文件是不能被普通用户读取的，只有超级用户才有权读取。
此外，需要注意的是，如果passwd字段中的第一个字符是“*”的话，那么，就表示该账号被查封了，系统不允许持有该账号的用户登录。
(3)用户标识号(UID)：UID是一个数值，是Linux系统中惟一的用户标识，用于区别不同的用户。在系统内部管理进程和文件保护时使用 UID字段。在Linux系统中，注册名和UID都可以用于标识用户，只不过对于系统来说UID更为重要；而对于用户来说注册名使用起来更方便。在某些特定目的下，系统中可以存在多个拥有不同注册名、但UID相同的用户，事实上，这些使用不同注册名的用户实际上是同一个用户。
(4)组标识号(GID)：这是当前用户的缺省工作组标识。具有相似属性的多个用户可以被分配到同一个组内，每个组都有自己的组名，且以自己的组标识号相区分。像UID一样，用户的组标识号也存放在passwd文件中。在现代的Unix/Linux中，每个用户可以同时属于多个组。除了在 passwd文件中指定其归属的基本组之外，还在/etc/group文件中指明一个组所包含用户。
(5)用户名(user_name)：包含有关用户的一些信息，如用户的真实姓名、办公室地址、联系电话等。在Linux系统中，mail和finger等程序利用这些信息来标识系统的用户。
(6)用户主目录(home_directory)：该字段定义了个人用户的主目录，当用户登录后，他的Shell将把该目录作为用户的工作目录。在Unix/Linux系统中，超级用户root的工作目录为/root；而其它个人用户在/home目录下均有自己独立的工作环境，系统在该目录下为每个用户配置了自己的主目录。个人用户的文件都放置在各自的
主目录下。
(7)命令解释程序(Shell)：Shell是当用户登录系统时运行的程序名称，通常是一个Shell程序的全路径名，
如/bin/bash。
*/
```

```
cat /etc/group |head -n 5


root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:syslog,jwj

//组名：密码：GID：该用户组中的用户列表

/*
/ect/group 文件是用户组配置文件，即用户组的所有信息都存放在此文件中。
(1)组名    用户组的名称，有字母或数字构成。同 /etc/passwd 中的用户名一样，组名也不能重复。
(2)组密码   和 /etc/passwd 文件一样，这里的 "x" 仅仅是密码标识，真正加密后的组密码默认保存在 /etc/gshadow 文件中。  用户组密码主要是用来指定组管理员的，由于系统中的账号可能会非常多，root 用户可能没有时间进行用户的组调整，这时可以给用户组指定组管理员，如果有用户需要加入或退出某用户组，可以由该组的组管理员替代 root 进行管理。但是这项功能目前很少使用，我们也很少设置组密码。如果需要赋予某用户调整某个用户组的权限，则可以使用 sudo 命令代替。
(3)组ID (GID)  就是群组的 ID 号，Linux 系统就是通过 GID 来区分用户组的，同用户名一样，组名也只是为了便于管理员记忆。
(4)组中的用户		此字段列出每个群组包含的所有用户。需要注意的是，如果该用户组是这个用户的初始组，则该用户不会写入这个字段，可以这么理解，该字段显示的用户都是这个用户组的附加用户。
*/
```



### 文件权限控制信息

#### 文件类型

`Linux` 中的文件有如下类型：

- 普通文件， 又包括文本文件和二进制文件， 可用 `touch` 创建；
- 套接字文件， 用于网络通讯，一般由应用程序在执行中间接创建；
- 管道文件是有名管道，而非无名管道， 可用 `mkfifo` 创建；
- 字符文件和块文件均为设备文件， 可用 `mknod` 创建；
- 链接文件是软链接文件，而非硬链接文件, 可用 `ln` 创建。

#### 访问权限控制组

分为三组进行控制：

- `user` 包含对文件属主设定的权限
- `group` 包含对文件属组设定的权限
- `others` 包含对其他者设定的权限

#### 可设定的权限

下面给出常见（但非全部）的权限值， 包括：

- `r` 表示具有读权限。
- `w` 表示具有写权限。
- `x` 一般针对可执行文件/目录，表示具有执行/搜索权限。
- `s` 一般针对可执行文件/目录，表示具有赋予文件属主权限的权限，只有 `user` 和 `group` 组可以设置该权限。
- `t` 一般针对目录，设置粘滞位后，有权限的用户只能写、删除自己的文件,否则可写、删除目录所有文件。旧系统还表示可执行文件运行后将text拷贝到交换区提升速度。

举例

通过 `ls -l` 可以查看到其文件类型及权限，通过 `chmod` 修改权限。

```
$ ls -l
总用量 20
drwxrwxr-x 2 jwj jwj  4096 9月  13 22:06  新建文件夹
-rwxr-xr-x 1 jwj jwj   187 9月  13 21:03 'IDA Free.desktop'
-rwxrwxrwx 1 jwj root 8650 8月   2 17:34  qaxbrowser-safe.desktop
/*
第一列	共10位，第1位表示文档类型，d表示目录，-表示文件，l表示链接文件，d表示可随机存取的设备，如U盘等，c表示一次性读取设备，如鼠标、键盘等。后9位，依次对应三种身份所拥有的权限，身份顺序为：owner、group、others，权限顺序为：r（readable）、w（writable）、x（excutable）。如：r-xr-x---的含义为当前文档是一个文件，拥有者可读、可执行，同一个群组下的用户，可读、可执行，其他人没有任何权限。
第二列	表示链接数，表示有多少个文件链接到inode号码。
第三列	表示拥有者
第四列	表示所属群组
第五列	表示文档容量大小，单位字节
第六列	表示文档最后修改时间，注意不是文档的创建时间哦
第七列	表示文档名称。以点(.)开头的是隐藏文档
*/
```

####  chown命令：修改文件和目录的所有者和所属组

​	chown 命令，可以认为是 "change owner" 的缩写，主要用于修改文件（或目录）的所有者，除此之外，这个命令也可以修改文件（或目录）的所属组。

```
 chown [-R] 所有者 文件或目录
 -R（注意大写）选项表示连同子目录中的所有文件，都更改所有者。
如果需要同时更改所有者和所属组，chown 命令的基本格式为：
chown [-R] 所有者:所属组 文件或目录
```

